"use client";

import { CheckSquare, Square } from "lucide-react";
import Image from "next/image";
import { useState } from "react";

interface Vulnerability {
    id: string;
    protocol: string;
    description: string;
    severity: "Critical" | "High" | "Medium" | "Low";
}

const VulnerabilityList = () => {
    const [filter, setFilter] = useState<"All" | "Critical" | "High" | "Medium" | "Low">("All");

    const vulnerabilities: Vulnerability[] = [
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Critical",
        },
        {
            id: "02",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via 'RFTLib.settle' to manipulate uniswap spot price when adding Maker liquidityAll taker collateral and collected fees can be stolen by re-entering via 'RFTLib.settle' to manipulate uniswap spot price when adding Maker liquidity",
            severity: "Critical",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Critical",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Medium",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Low",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "High",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Medium",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Medium",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Medium",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Medium",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Medium",
        },
        {
            id: "01",
            protocol: "Metadot",
            description: "All taker collateral and collected fees can be stolen by re-entering via...",
            severity: "Medium",
        },
    ];

    const filteredVulnerabilities =
        filter === "All"
            ? vulnerabilities
            : vulnerabilities.filter((v) => v.severity === filter);

    const getSeverityColor = (severity: string) => {
        switch (severity) {
            case "Critical":
                return "text-danger border-danger bg-danger/20";
            case "High":
                return "text-secondary border-secondary bg-secondary/10";
            case "Medium":
                return "text-warning border-warning bg-warning/10";
            case "Low":
                return "text-success border-success bg-success/10";
            default:
                return "text-foreground border-foreground";
        }
    };

    const getSeverityLetter = (severity: string) => {
        return severity.charAt(0);
    }

    return (
        <div className="flex flex-col h-full w-full">
            {/* Filters Header */}
            <div className="flex items-center justify-between gap-4 px-4 py-2 border-b border-foreground/50 text-sm text-foreground">
                {(["All", "Critical", "High", "Medium", "Low"] as const).map((f) => (
                    <div
                        key={f}
                        className={`flex items-center gap-1 cursor-pointer hover:text-white transition-colors ${filter === f ? "text-white" : ""
                            }`}
                        onClick={() => setFilter(f)}
                    >
                        <span>{f} {f === "All" ? "(160)" : ""}</span>
                        {filter === f ? <CheckSquare size={12} /> : <Square size={12} />}
                    </div>
                ))}
            </div>

            {/* Table Header */}
            <div className="grid grid-cols-[50px_100px_1fr_70px] gap-4 px-4 py-2 border-b border-foreground/50 text-sm text-foreground">
                <div>/No</div>
                <div>/Protocol</div>
                <div>/Vulnerability</div>
                <div className="text-center">/Severity</div>
            </div>

            {/* List Content */}
            <div className="flex-1 overflow-y-auto hide-scrollbar">
                {filteredVulnerabilities.map((v, i) => (
                    <div
                        key={i}
                        className="grid grid-cols-[50px_100px_1fr_50px] gap-4 px-4 py-3 border-b border-foreground/50 text-base hover:bg-dark transition-colors items-start cursor-pointer"
                    >
                        <div className="text-foreground pt-1">{v.id}</div>
                        <div className="flex items-center gap-2 pt-1">
                            <div className="">
                                <Image src='/assets/protocol.png' alt="Protocol" width={30} height={30} />
                            </div>
                            <span className="text-foreground">{v.protocol}</span>
                        </div>
                        <div className="text-foreground leading-relaxed line-clamp-3">
                            {v.description}
                        </div>
                        <div className="flex justify-center">
                            <div className={`w-6 h-6 text-base flex items-center justify-center border-b  ${getSeverityColor(v.severity)}`}>
                                {getSeverityLetter(v.severity)}
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
};

export default VulnerabilityList;
